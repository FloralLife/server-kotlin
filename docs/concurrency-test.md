# 낙관적 락 vs 비관적 락

* 기존에 동시성 이슈가 발생할 수 있는 곳은 이미 모두 비관적 락으로 처리를 해 놓았음
* 낙관적 락의 다음 특징으로 인해 customer coupon의 사용에 적용하기 좋아 보였음
  * 한번 성공하고 나머지 요청은 실패하는 경우에 사용하기 좋음
  * 충돌이 많이 발생하지 않는 경우에 쓸모 없어지는 락이 걸리지 않기 때문에 성능상 유리함

### 성능 테스트

* 비관적 / 낙관적 락 상황에서 성공 / 충돌이 발생해 실패한 경우의 시간을 각각 100 번씩 측정

|    | Pessimistic Lock / 성공 (µs) | Pessimistic Lock / 실패 (µs) | Optimistic Lock / 성공 (µs) | Optimistic Lock / 실패 (µs) |
|----|----------------------------|----------------------------|---------------------------|---------------------------|
| 최대 | 17125                      | 9841                       | 13953                     | 8378                      |
| 평균 | 10517.723                  | 3392.492                   | 8026.985                  | 2386.446                  |
| 최소 | 6639                       | 2142                       | 5361                      | 1545                      |

#### 결과
* 주문에서 충돌로 인해 실패하면 에러가 발생하는 시점의 차이가 있긴 하지만 성공 / 실패 상황에서 낙관적 락에 비해 비관적 락일 때 속도가 느렸다.
* Version으로 인해 한번만 성공하고, 쿠폰은 한번만 사용하면 되기 때문에 성능이 더 좋은 낙관적 락을 채택하는 것이 좋아보인다. 
